<!doctype html><html><head>
<meta charset="utf-8"/>
<title>Metals Trends from Investing.com</title>
<style>
 body{font-family:-apple-system,system-ui;padding:20px;background:#fafafa}
 #card{max-width:960px;margin:auto;background:#fff;padding:16px;border-radius:8px;
       box-shadow:0 4px 14px rgba(0,0,0,.08);}
 canvas{width:100%!important;height:420px!important}
 small{color:#666}
</style>
</head><body>
<div id="card">
 <h3>Metals — 12-Month Trend (Investing.com Scraped)</h3>
 <small>Gold & Palladium ÷1000, Silver ÷10</small>
 <div id="status" style="margin-bottom:10px;color:#444"></div>
 <canvas id="chart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(async()=>{

  const setStatus = t => document.getElementById("status").innerText = t;

  // UPDATED CORRECT URLs
  const SOURCES = {
    Gold:      "https://www.investing.com/currencies/xau-usd-historical-data",
    Silver:    "https://www.investing.com/currencies/xag-usd-historical-data",
    Palladium: "https://www.investing.com/currencies/xpd-usd-historical-data",
    Copper:    "https://www.investing.com/commodities/copper-historical-data"
  };

  const NORMALIZE = {
    Gold: 1000,
    Silver: 10,
    Palladium: 1000,
    Copper: 1
  };

  async function loadInvesting(url){
    const proxy = "https://corsproxy.io/?";
    const html = await fetch(proxy + encodeURIComponent(url)).then(r=>r.text());
    const doc = new DOMParser().parseFromString(html, "text/html");

    const rows = [...doc.querySelectorAll("table tbody tr")];
    const out = [];

    for(const tr of rows){
      const tds = tr.querySelectorAll("td");
      if(tds.length < 6) continue;

      const dateStr = tds[0].textContent.trim();
      const priceStr = tds[1].textContent.trim().replace(/,/g,"");
      const price = parseFloat(priceStr);

      const date = new Date(dateStr);
      if(isNaN(price) || isNaN(date)) continue;

      out.push({
        date: date.toISOString().slice(0,10),
        price
      });
    }
    return out.reverse();
  }

  setStatus("Downloading data…");

  let raw = {};

  for(const metal of Object.keys(SOURCES)){
    setStatus(`Loading ${metal}…`);
    try{
      raw[metal] = await loadInvesting(SOURCES[metal]);
    }catch(e){
      console.error(e);
      setStatus(`Error loading ${metal}`);
    }
  }

  setStatus("Processing…");

  const allDates = new Set();
  Object.values(raw).forEach(list => list.forEach(r => allDates.add(r.date)));
  const dates = [...allDates].sort();

  const datasets = Object.keys(raw).map(name=>{
    const map = new Map(raw[name].map(o=>[o.date,o.price]));
    return {
      label: name,
      data: dates.map(d => map.has(d) ? map.get(d)/NORMALIZE[name] : null),
      tension: .2
    };
  });

  new Chart(document.getElementById("chart"),{
    type:"line",
    data:{labels:dates, datasets},
    options:{
      interaction:{mode:"index",intersect:false},
      scales:{y:{title:{display:true,text:"Normalized"}}}
    }
  });

  setStatus("Done — chart loaded.");

})();
</script>
</body></html>
